name: å¤‡ä»½äºŒè¿›åˆ¶ç¨‹åº

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 4 */3 * *'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - name: æ‹‰å–ä»£ç 
      uses: actions/checkout@v4

    - name: åˆ é™¤å·²å­˜åœ¨çš„å‘è¡Œç‰ˆ
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh release delete v1.0.0 -y || true
        git tag -d v1.0.0 || true
        git push origin --delete v1.0.0 || true

    - name: åˆ›å»ºä¸€ä¸ªæ–°çš„å‘è¡Œç‰ˆ
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git tag v1.0.0
        git push origin v1.0.0
        mkdir dist
        curl -o ./dist/nezha-agent_linux_amd64.zip https://github.com/nezhahq/agent/releases/latest/download/nezha-agent_linux_amd64.zip
        gh release create v1.0.0 ./dist/* --title "v1.0.0" --notes "ğŸ”¥ æ—¶æ¥ä¸Šä¸‹çš†åŒåŠ›ï¼Œè¿å»è‹±é›„ä¸è‡ªç”±ï¼"